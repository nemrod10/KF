
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Kinetic Fusillade Calculator by Nemrod</title>
   <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* --- ambiance gÃ©nÃ©rale --- */
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      background: url('fond.png') center/cover no-repeat, #1a1815;
      min-height: 100vh;
      margin: 0;
      padding: 2% 10% ;
      color: #e1cf8d;
      box-sizing: border-box;
    }
    .container {
      margin-left: 78px;      /* ou adapter Ã  la largeur du motif dÃ©coratif */
	  margin-right: auto;
      background: rgba(34, 21, 8, 0.94);
      border-radius: 15px;
      box-shadow: 0 3px 24px #1a181599;
      padding: 36px 44px 44px 44px;
      border: 2.5px solid #ae8648;
      position: relative;
    }
    h2 {
      font-family: 'MedievalSharp', Arial, sans-serif;
      color: #FFD700;
      font-size: 2.1rem;
      margin-bottom: 22px;
      letter-spacing: 3px;
      text-shadow: 1px 1px 8px #aa6c1e;
	  text-align: center;
    }
	h3 {
  color: #0f0f0f;
  font-family: 'MedievalSharp', Arial, sans-serif;
  font-size: 1.08rem;
  letter-spacing: 2px;
  text-shadow: 0 1px 7px #392206;
  background: linear-gradient(90deg, #bb9154 60%, #381b09 100%);
  border-left: 4px solid #b88e54;
  border-radius: 5px;
  padding: 6px 16px 6px 14px;
  margin-bottom: 16px;
  margin-top: 22px;
}

    /* --- input stylÃ© --- */
    .input-row {
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      font-size: 1.11rem;
      font-family: 'MedievalSharp', Arial, sans-serif;
      color: #e1cf8d;
    }
    label { width: 240px; font-weight: bold;}
    input {
      width: 70px;
      padding: 6px 11px;
      background: #23201a;
      color: #FFD700;
      border: 1.9px solid #aa6c1e;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.15s;
      margin-right: 10px;
      outline: none;
    }
    input:focus {
      border-color: #e1cf8d;
      background: #191714;
    }
    button {
      margin-top: 16px;
      font-family: 'MedievalSharp', Arial, sans-serif;
      background: linear-gradient(90deg,#b48626 55%, #ae8648 100%);
      color: #1a130a;
      padding: 9px 32px;
      border-radius: 8px;
      font-size: 1.14rem;
      border: 2px solid #ae8648;
      cursor: pointer;
      letter-spacing: 2px;
      font-weight: bold;
      box-shadow: 0 1px 6px #0007;
      transition: background .16s, color .19s;
    }
    button:hover {
      background: linear-gradient(90deg,#FFD700 65%, #b48626 100%);
      color: #5e3900;
      border-color: #FFD700;
    }

    /* --- icone d'aide --- */
    .help-icon {
      display: inline-block;
      width: 21px;
      height: 21px;
      background: radial-gradient(circle at 25% 30%, #FFD700 54%, #ae8648 100%);
      color: #23201a;
      text-align: center;
      font-weight: bold;
      line-height: 21px;
      margin-left: 13px;
      font-size: 16px;
      border-radius: 50%;
      cursor: pointer;
      border: 1.4px solid #ae8648;
      box-shadow: 0 1px 5px #ae8648cc;
      position: relative;
      vertical-align: middle;
      transition: background .12s;
    }
    .help-icon:hover { background: #FFD700; color: #ae8648;}
    .help-bubble {
      display: none;
      position: absolute;
      top: 26px;
      left: -40px;
      z-index: 999;
      background: #191714;
      border: 2px solid #ae8648;
      padding: 8px;
      border-radius: 7px;
      box-shadow: 0 2px 12px #b4862677;
      min-width: 200px;
      text-align: center;
      color: #e1cf8d;
    }
    .help-bubble img { max-width: 800px; max-height: 800px; }

    /* --- barre --- */
    .bar-container {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin: 40px auto 0 auto;
      min-height: 70px;
    }
    .echelle-color {
      width: 100%;
      height: 22px;
      border-radius: 8px;
      background: #333;
      display: block;
      border: 1px solid #b88e54;
    }
    .bar-red {
      background: linear-gradient(to right, #dd3333 0%, #dd3333 var(--pct-red), #ffaa00 var(--pct-red), #ffaa00 var(--pct-orange), #46be7c var(--pct-orange), #46be7c 100%);
    }

    .labels-setup { 
      width: 800px; 
	  background: none !important;
      display: flex; 
      justify-content: space-between; 
      font-size: 15px; 
	  margin-top: 5px;
	  margin-bottom: 10px;
	  padding: 0 22px;
      font-weight: bold;
      position: absolute; 
      top: 0;
      left: 0;
      pointer-events: none;
      user-select: none;
      height: 25px;
    }
    .label-red   { color: #dd3333; margin-left: 4px; text-shadow: 0 1px 6px #221;font-weight: bold;
  font-size: 12px;
  max-width: 180px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;}
    .label-orange { color: #ffaa00; text-align: center;font-weight: bold;
  font-size: 12px;
  max-width: 180px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;}
    .label-green { color: #46be7c; margin-right: 4px;font-weight: bold;
  font-size: 12px;
  max-width: 180px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;}
    
    .curseur {
      position: absolute;
      top: 0;
      height: 70px;
      width: 0;
      pointer-events:none;
    }
    .curseur-arrow {
      width: 0;
      height: 0;
      border-left: 9px solid transparent;
      border-right: 9px solid transparent;
      border-top: 18px solid #ffd700;
      filter: drop-shadow(0 0 10px #ffd70099);
    }
    .curseur span {
      position: absolute;
      left: -35px;
      top: 50px;
      background: #191714;
      color: #FFD700;
      font-size: 13px;
      border-radius: 6px;
      padding: 3px 11px;
      font-weight: bold;
      white-space: nowrap;
      border: 1.5px solid #ae8648;
      box-shadow: 0 2px 14px #ae864877;
    }

    /* --- ligne APS breakpoint --- */
    #aps-breakpoint {
      display:none;
      margin:22px 0 0 0;
      font-size:16.2px;
      font-weight:bold;
      color:#ffd700;
      text-align: center;
      border-radius: 6px;
      padding: 7px;
      border: 1.6px solid #ae8648;
      background: #191714;
      box-shadow: 0 2px 10px #996c1e77;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
      letter-spacing: 1px;
    }

    /* --- message conditionnel --- */
    .info-message {
      margin-top: 25px;
      font-size: 18px;
      font-weight: bold;
      text-align: left;
      padding: 14px;
      border-radius: 8px;
      background: #18140d;
      border: 2.3px solid #ae8648;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 2px 15px #ae864877;
      color: #FFD700;
    }
    .info-warning { color: #c40e0e; border-color: #c40e0e; background: #281715; }
    .info-orange { color: #ffaa00; border-color: #ffaa00; background: #2c220c; }
    .info-green { color: #1b814d; border-color: #46be7c; background: #113a2c; }

    .info-congrats {
      color: #FFD700;
      background: #2c220c;
      border: 2px solid #FFD700;
      border-radius: 8px;
      padding: 14px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      box-shadow: 0 2px 7px #FFD70099;
      margin-top: 18px;
      display: block;
      animation: pulse 1.2s infinite alternate;
      letter-spacing: 2px;
      text-shadow: 0 1px 8px #FFD70055;
    }

    @keyframes pulse {
      0% { box-shadow: 0 2px 7px #FFD70055; transform: scale(1);}
      100% { box-shadow: 0 4px 14px #FFD70099; transform: scale(1.04);}
    }

    /* --- animation confettis --- */
    .animation-congrats {
      pointer-events: none;
      position: fixed;
      top: 30%;
      left: 44vw;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.3s;
    }
    /* Responsive */
    @media (max-width: 1000px) {
      .container, .bar-container, .labels-setup { width: 98vw; min-width: 320px; }
      .bar-container { min-width: 310px;}
    }
    @media (max-width: 700px) {
      h2 { font-size: 1.3rem;}
      .container { padding: 16px 5vw;}
      label, .input-row { font-size: 0.95rem;}
      .bar-container, .labels-setup { width: 98vw;}
      #aps-breakpoint, .info-message { font-size: 15px;}
    }
	
  </style>
</head>
<body>
  <h2>Kinetic Fusillade Calculator (Beta)</h2>
  <p>Hover the ? button to see where you can find informations on PoB (all is in calculation page)</p>
  <h3>Breakpoint calculation</h3>
  <form id="calc-form">
    <div class="input-row">
      <label>Number of Projectiles :</label> 
      <input type="number" id="A" value="12">
      <span class="help-icon" 
        onmouseenter="showHelp(this)" 
        onmouseleave="hideHelp(this)">?
        <span class="help-bubble"><img src="proj.png" alt="Trouver Projectiles"></span>
      </span>
    </div>
    <div class="input-row">
      <label>Reduce skill duration :</label>
      <input type="number" id="B" value="0.25" step="0.01">
      <span class="help-icon" 
        onmouseenter="showHelp(this)" 
        onmouseleave="hideHelp(this)">?
        <span class="help-bubble"><img src="reduc_dura.png" alt="Trouver Reduce Duration"></span>
      </span>
    </div>
    <div class="input-row">
      <label>Less skill duration :</label>
      <input type="number" id="C" value="0.4" step="0.01">
      <span class="help-icon" 
        onmouseenter="showHelp(this)" 
        onmouseleave="hideHelp(this)">?
        <span class="help-bubble"><img src="less_dura.png" alt="Trouver Less Duration"></span>
      </span>
    </div>
    <div class="input-row">
      <label>Attack speed :</label>
      <input type="number" id="D" value="8.51" step="0.01">
      <span class="help-icon" 
        onmouseenter="showHelp(this)" 
        onmouseleave="hideHelp(this)">?
        <span class="help-bubble"><img src="aps.png" alt="Trouver Attack Speed actuelle"></span>
      </span>
    </div>
	<h3>Usefull information for min-maxing</h3>
	<p>If you change those values after first calculation, you need to check PoB to have your new attack speed and make a new calcul.</p>
    <div class="input-row">
      <label>% Increased atk speed :</label>
      <input type="number" id="E" value="151" step="0.01">
      <span class="help-icon" 
        onmouseenter="showHelp(this)" 
        onmouseleave="hideHelp(this)">?
        <span class="help-bubble"><img src="inc_aps.png" alt="Trouver Increased Attack Speed"></span>
      </span>
    </div>
    <div class="input-row">
      <label>% More atk speed :</label>
      <input type="number" id="F" value="0" step="0.01">
      <span class="help-icon" 
        onmouseenter="showHelp(this)" 
        onmouseleave="hideHelp(this)">?
        <span class="help-bubble"><img src="more_aps.png" alt="Trouver More Attack Speed"></span>
      </span>
    </div>
    <div class="input-row">
      <label>% More action speed :</label>
      <input type="number" id="G" value="1.06" step="0.01">
      <span class="help-icon" 
        onmouseenter="showHelp(this)" 
        onmouseleave="hideHelp(this)">?
        <span class="help-bubble"><img src="action_speed.png" alt="Trouver More Action Speed"></span>
      </span>
    </div>
    <button type="button" onclick="calculSalvo()">Calculate</button>
  </form>
  <div style="height: 12px;"></div>

  <div class="bar-container" id="bar-zone" style="display:none;">
    <div class="labels-setup" id="labels-setup">
      <div class="label-red" id="label-red">No machine gun</div>
      <div class="label-orange" id="label-orange">Imperfect setup</div>
      <div class="label-green" id="label-green">Perfect setup</div>
    </div>
    <div class="echelle-color bar-red" id="salvo-bar"></div>
    <div class="curseur" id="curseur">
      <div class="curseur-arrow"></div>
      <span id="curseur_txt"></span>
    </div>
  </div>
   <div id="aps-breakpoint" style="display:none; margin:20px 0 0 0; font-size:15px; font-weight:bold; color:#337ab7;">
  </div>
  <div class="info-message" id="info-message" style="display:none;"></div>
  <div id="congratsAnimation" class="animation-congrats" style="opacity:0;">
    <svg width="120" height="120" viewBox="0 0 120 120">
      <circle cx="20" cy="40" r="7" fill="#ffb700"><animate attributeName="cy" values="40;80;120" dur="2s" repeatCount="indefinite" /></circle>
      <circle cx="80" cy="15" r="6" fill="#1bc47d"><animate attributeName="cy" values="15;75;120" dur="2s" repeatCount="indefinite" /></circle>
      <circle cx="55" cy="60" r="5" fill="#f84f7c"><animate attributeName="cy" values="60;100;120" dur="2s" repeatCount="indefinite" /></circle>
      <rect x="95" y="10" width="8" height="8" fill="#3584e7"><animate attributeName="y" values="10;70;120" dur="2s" repeatCount="indefinite" /></rect>
      <rect x="30" y="70" width="6" height="6" fill="#e6750a"><animate attributeName="y" values="70;100;120" dur="2s" repeatCount="indefinite" /></rect>
    </svg>
  </div>

  <script>
function round(val, dec=4) { return Math.round(val*10**dec)/10**dec; }
function ceil(val) { return Math.ceil(Math.abs(val)); }
function floor(val) { return Math.floor(Math.abs(val)); }

const barWidth = 800;

const redWidth = (pct_red / 100) * barWidth;
const orangeWidth = ((pct_orange - pct_red) / 100) * barWidth;
const greenWidth = ((100 - pct_orange) / 100) * barWidth;

// Labels centrÃ©s et largeur limitÃ©e
lblRed.style.position = "absolute";
lblRed.style.left = (redWidth * 0.5 - 80) + "px";      // Centre dans zone rouge, dÃ©cale pour la largeur
lblRed.style.width = (redWidth - 20) + "px";
lblRed.style.textAlign = "center";
lblRed.style.overflow = "hidden";
lblRed.style.whiteSpace = "nowrap";

lblOrange.style.position = "absolute";
lblOrange.style.left = (redWidth + orangeWidth * 0.5 - 80) + "px"; // Centre dans zone orange
lblOrange.style.width = (orangeWidth + 20) + "px";
lblOrange.style.textAlign = "center";
lblOrange.style.overflow = "hidden";
lblOrange.style.whiteSpace = "nowrap";

lblGreen.style.position = "absolute";
lblGreen.style.left = (redWidth + orangeWidth + greenWidth * 0.5 - 80) + "px"; // Centre dans zone verte
lblGreen.style.width = (greenWidth - 20) + "px";
lblGreen.style.textAlign = "center";
lblGreen.style.overflow = "hidden";
lblGreen.style.whiteSpace = "nowrap";


function calculSalvo() {
  // lire champs
  const A = parseFloat(document.getElementById('A').value);
  const B = parseFloat(document.getElementById('B').value);
  const C = parseFloat(document.getElementById('C').value);
  const D = parseFloat(document.getElementById('D').value);
  const E = parseFloat(document.getElementById('E').value);
  const F = parseFloat(document.getElementById('F').value);
  const G = parseFloat(document.getElementById('G').value);

  const duration_mod = round(B * C);
  const hovering_time = round(0.7 * duration_mod);
  const firing_time = round(0.05 * duration_mod * A);
  const salvo_time = round(firing_time + hovering_time);
  const target_speed = round(1 / salvo_time);
  const player_atk_time = round(1 / D);
  const base_atk_speed = round(D / (1 + E/100) / (1 + F/100) / G);
  const new_inc_aps = round(((target_speed / (base_atk_speed * (1 + F/100) * G)) - 1) * 100); 
  const modificateur_aps = round(new_inc_aps - E);
  const missing_projectile = Math.ceil((salvo_time - player_atk_time) / (0.05 * duration_mod));

  document.getElementById('bar-zone').style.display = '';
  const bar = document.getElementById('salvo-bar');
  const barElem = document.getElementById('salvo-bar');
  const barWidth = barElem.offsetWidth || 800;
  const max_bar = round(salvo_time + 0.1);
  const pct_red = (hovering_time / max_bar) * 100;
  const pct_orange = (salvo_time / max_bar) * 100;
  bar.style.setProperty('--pct-red', pct_red + '%');
  bar.style.setProperty('--pct-orange', pct_orange + '%');
  bar.title = `Rouge : 0â€“${hovering_time}s | Orange : ${hovering_time}â€“${salvo_time}s | Vert : ${salvo_time}â€“${max_bar}s`;

  // Curseur atk time
  const curseur = document.getElementById('curseur');
  const curseur_txt = document.getElementById('curseur_txt');
  let pos_curseur = (player_atk_time / max_bar) * barWidth;
  if(pos_curseur < 0) pos_curseur = 0;
  if(pos_curseur > barWidth) pos_curseur = barWidth;
  curseur.style.left = pos_curseur +"px";
  curseur_txt.innerText = `Player Atk Time : ${player_atk_time}s`;
  
  // Affichage APS breakpoint avec arrondi infÃ©rieur Ã  2 dÃ©cimales
const apsDiv = document.getElementById('aps-breakpoint');
apsDiv.style.display = '';
const target_speed_display = Math.floor(target_speed * 100) / 100;
apsDiv.innerHTML = `Your closest APS breakpoint is <span style="color:#169e41">${target_speed_display}</span> attack per second`;

  // Placement dynamique des labels
  const lblRed = document.getElementById('label-red');
  const lblOrange = document.getElementById('label-orange');
  const lblGreen = document.getElementById('label-green');
  lblRed.style.position = "absolute";
  lblRed.style.left = "2px";
  lblRed.style.top = "22px";
  lblOrange.style.position = "absolute";
  lblOrange.style.left = (pct_red * 8 + 2) + "px";
  lblOrange.style.top = "22px";
  lblGreen.style.position = "absolute";
  lblGreen.style.left = (pct_orange * 8 + 2) + "px";
  lblGreen.style.top = "22px";

  // Info conditionnelle avec detection Ã©galitÃ©
  let info = "";
  let infoClass = "";
  let congrats = false;
  if (Math.abs(player_atk_time - salvo_time) < 0.0001) {
    info = `<span class="info-congrats">ðŸŽ‰ Congratulations, your setup is perfect! ðŸŽ‰</span>`;
    congrats = true;
  } else if (player_atk_time < hovering_time) {
    info = 
      `âš ï¸ Warning: No machine gun, you need to remove <b>${ceil(modificateur_aps)}%</b> of increased attack speed.<br>
      You can also try to take more reduce skill effect duration, reduce number of projectiles or reduce action speed.`;
    infoClass = "info-warning";
  } else if (player_atk_time < salvo_time) {
    info = 
      `âš ï¸ You have a bit too much APS to have a perfect setup.<br>
	  You lose <b>${missing_projectile}</b> projectile(s) with your actual APS.<br>
      You need to remove <b>${ceil(modificateur_aps)}%</b> of increased attack speed.<br>
      You can also reduce a bit "more atk speed", "action speed" or take some additionnal reduce skill duration and try calculate again.`;
    infoClass = "info-orange";
  } else {
    info = 
      `âœ… You have a good setup.<br>
      You can add <b>${floor(modificateur_aps)}%</b> of increased attack speed to min max dps, but no more!`;
    infoClass = "info-green";
  }
  const infoDiv = document.getElementById('info-message');
  infoDiv.style.display = '';
  infoDiv.className = 'info-message ' + infoClass;
  infoDiv.innerHTML = info;

  // Animation congrats
  const animation = document.getElementById('congratsAnimation');
  if (congrats) {
    animation.style.opacity = 1;
    setTimeout(() => { animation.style.opacity = 0; }, 2000);
  } else {
    animation.style.opacity = 0;
  }
}

// Aide au survol
function showHelp(el) {
  const bubble = el.querySelector('.help-bubble');
  if (bubble) bubble.style.display = 'block';
}
function hideHelp(el) {
  const bubble = el.querySelector('.help-bubble');
  if (bubble) bubble.style.display = 'none';
}
window.addEventListener('resize', calculSalvo);
window.addEventListener('DOMContentLoaded', calculSalvo);
  </script>
</body>
</html>
